<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Raw Accel LUT Curve Maker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
background:#000;
color:#fff;
font-family:Arial;
margin:0;
text-align:center;
}

header{
padding:20px;
background:#111;
}

.logo{
width:80px;
height:80px;
border-radius:50%;
object-fit:cover;
margin-bottom:8px;
box-shadow:0 0 15px rgba(255,255,255,.2);
}

.title{font-size:26px;}
.credit{font-size:14px;color:#aaa;}

.container{
width:90%;
max-width:1000px;
margin:auto;
}

.card{
background:#111;
padding:20px;
margin-top:20px;
border-radius:12px;
}

input,select{
background:#000;
color:#fff;
border:1px solid #333;
padding:6px;
margin:5px;
}

button{
margin:8px;
padding:10px 16px;
background:#fff;
color:#000;
border:none;
border-radius:6px;
cursor:pointer;
}

textarea{
width:100%;
height:150px;
background:#000;
color:#fff;
border:1px solid #333;
margin-top:10px;
font-family:monospace;
}
</style>
</head>

<body>

<header>

<img class="logo"
src="https://yt3.googleusercontent.com/G3NBG71dzJtbQ3ae2ERcVDRvXGEHaAlCO43-fnO-uilXeikc5mYWp2p2k4owzc4S5n0brzNC=s160-c-k-c0x00ffffff-no-rj">

<div class="title">Raw Accel LUT Curve Maker</div>
<div class="credit">Made by @repodatabase</div>

</header>

<div class="container">

<div class="card">
DPI <input id="dpi" value="800">
Poll Rate <input id="poll" value="1000">

Curve Style
<select id="curveStyle" onchange="updateCurveStyle()">
<option value="0">Sharp Linear</option>
<option value="0.35">Smooth</option>
<option value="0.7">Very Smooth</option>
</select>

<button onclick="applyScale()">Apply Scale</button>
</div>

<div class="card">
Click add point<br>
Drag move<br>
Right click delete<br>
Mouse wheel zoom<br>
Paste LUT then Load LUT
</div>

<div class="card">

<canvas id="chart"></canvas>

<button onclick="exportLUT()">Export LUT</button>
<button onclick="importLUT()">Load LUT</button>
<button onclick="resetLine()">Reset Straight Line</button>

<textarea id="output"></textarea>

</div>

</div>

<script>

/* ================= SETTINGS ================= */

let dpi=800;
let poll=1000;
let zoom=1;

/* RAW ACCEL SAFE DEFAULT */
let points=[
{x:0.001,y:1},
{x:100,y:1}
];

const ctx=document.getElementById("chart");

/* ================= SPEED SCALE ================= */

function calculateMaxSpeed(){
return (dpi*poll/8000)*zoom;
}

/* ================= CHART ================= */

const chart=new Chart(ctx,{
type:"line",
data:{
datasets:[{
data:points,
parsing:false,
borderColor:"white",
pointRadius:6,
tension:0
}]
},
options:{
animation:false,
responsive:true,
scales:{
x:{
type:"linear",
min:0.001,
max:calculateMaxSpeed(),
ticks:{color:"white"},
grid:{color:"#222"}
},
y:{
min:0,
max:2,
ticks:{color:"white"},
grid:{color:"#222"}
}
},
plugins:{legend:{display:false}}
}
});

/* ================= SCALE ================= */

function applyScale(){
dpi=Number(document.getElementById("dpi").value)||800;
poll=Number(document.getElementById("poll").value)||1000;

chart.options.scales.x.max=calculateMaxSpeed();
chart.update();
}

/* ================= CURVE STYLE ================= */

function updateCurveStyle(){
chart.data.datasets[0].tension=
Number(document.getElementById("curveStyle").value);
chart.update();
}

/* ================= AUTO FIX ENGINE ================= */

function autoFix(){

points=points
.filter(p=>isFinite(p.x)&&isFinite(p.y));

if(points.length<2){
points=[
{x:0.001,y:1},
{x:calculateMaxSpeed(),y:1}
];
}

points.sort((a,b)=>a.x-b.x);

let lastX=0.001;

for(let p of points){

p.x=Math.max(0.001,p.x);

if(p.x<=lastX)
p.x=lastX+0.001;

p.y=Math.max(0,Math.min(5,p.y));

lastX=p.x;
}
}

/* ================= ZOOM ================= */

ctx.addEventListener("wheel",e=>{
e.preventDefault();

zoom*=e.deltaY<0?1.1:0.9;
zoom=Math.max(.2,Math.min(zoom,10));

chart.options.scales.x.max=calculateMaxSpeed();
chart.update();
});

/* ================= ADD POINT ================= */

ctx.onclick=e=>{
if(draggingPoint!==null) return;

const rect=ctx.getBoundingClientRect();

points.push({
x:chart.scales.x.getValueForPixel(e.clientX-rect.left),
y:chart.scales.y.getValueForPixel(e.clientY-rect.top)
});

autoFix();
updateChart();
};

/* ================= DELETE ================= */

ctx.oncontextmenu=e=>{
e.preventDefault();

const el=chart.getElementsAtEventForMode(
e,'nearest',{intersect:true},false
);

if(el.length){
points.splice(el[0].index,1);
updateChart();
}
};

/* ================= DRAG ================= */

let draggingPoint=null;

ctx.onmousedown=e=>{
const el=chart.getElementsAtEventForMode(
e,'nearest',{intersect:true},false
);
if(el.length) draggingPoint=el[0].index;
};

ctx.onmousemove=e=>{

if(draggingPoint===null) return;

const rect=ctx.getBoundingClientRect();

points[draggingPoint].x=
chart.scales.x.getValueForPixel(e.clientX-rect.left);

points[draggingPoint].y=
chart.scales.y.getValueForPixel(e.clientY-rect.top);

autoFix();
updateChart();
};

window.onmouseup=()=>draggingPoint=null;

/* ================= UPDATE ================= */

function updateChart(){
chart.data.datasets[0].data=points;
chart.update();
}

/* ================= EXPORT SAFE ================= */

function exportLUT(){

autoFix();

const maxX=calculateMaxSpeed();

let clean=[
{x:0.001,y:1},
...points,
{x:maxX,y:1}
];

clean.sort((a,b)=>a.x-b.x);

clean=clean.filter((p,i,a)=>i===0||p.x>a[i-1].x);

const text=clean
.map(p=>`${p.x.toFixed(3)},${p.y.toFixed(3)};`)
.join("\n");

document.getElementById("output").value=text;
}

/* ================= IMPORT ================= */

function importLUT(){

const text=document.getElementById("output").value.trim();
if(!text) return;

points=text.split(";")
.filter(v=>v.trim())
.map(line=>{
const [x,y]=line.split(",");
return {x:parseFloat(x),y:parseFloat(y)};
})
.filter(p=>isFinite(p.x)&&isFinite(p.y));

autoFix();
updateChart();
}

/* ================= RESET ================= */

function resetLine(){
points=[
{x:0.001,y:1},
{x:calculateMaxSpeed(),y:1}
];
updateChart();
}

updateChart();

</script>
</body>
</html>

